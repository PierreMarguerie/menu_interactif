<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../css/styles.css">
    <link rel="stylesheet" type="text/css" href="../css/depot.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
<div class="h-screen w-screen bg-cover absolute z-10" style="background-image: url('Images/map.jpg')"></div> <!-- Fond (map) -->

<div style="display: inline-flex; top: 8rem; left: 23rem; width: 70vw; height: 73vh;" class="bg-transparent absolute z-30">
    <div class="items-center rounded-3xl w-full h-full" style="border-radius: 15px;position: relative; background-color: #F5F6F6;">
        <div class="text-center w-[50vw] pt-[10vh] pl-[22vw]" style="font-size: 0.90vw; font-weight: 700;">
            <form id="form" style="font-size: 0.90vw;display: inline-block; text-align: left; padding-top: 3rem;">
                <label class="text-left" for="resourceName">Nom de la ressource</label><br>
                <input style="width: 10vw;" type="text" id="resourceName" name="resourceName" required><br> <!-- resource_name box -->
                <span style="line-height: 45px"></span>
                <label class="text-left" for="link">Lien vers la ressource</label><br>
                <input style="width: 21.2vw;" type="text" id="link" name="link" required><br> <!-- link Box -->
                <span style="line-height: 45px"></span>
                <label class="text-left" for="areaName">Nom de la zone de la ressource</label><br>
                <input style="width: 25vw;" type="text" id="areaName" name="areaName" required><br> <!-- areaName Box -->
                <div style="font-size: 15px; font-weight: 300;">N'oubliez pas d'ajouter la propriété "zone de départ"</div>
                <div style="font-size: 15px; font-weight: 300;">Le nom ne doit pas contenir d'espaces.</div>
                <span style="line-height: 45px"></span>
                <label class="text-left" for="room">Salle de dépôt de la ressource</label><br>
                <input style="width: 21.2vw;" type="text" id="room" name="room" required><br> <!-- Room Box -->
                <br>
                <div id="drop-area" class="drop-area" style="position: relative; background-image: url('Images/dragndrop.png');">
                    <div style="font-size: 15px; z-index: 2; position: relative;">Capture d'écran de la zone</div>
                    <div style="position: relative; padding-top: 140px; z-index: 2;">
                        <input type="file" id="fileInput" class="file-input" style="z-index: 2; position: absolute;">
                        <button type="button" class="custom-button" style="z-index: 2; position: relative;">Parcourir</button>
                    </div>
                    <img id="preview" style="position: absolute; top: 50%; left: 50%; display: none; z-index: 1; max-width: 80%; max-height: 80%; transform: translate(-50%, -50%);" />
                </div>
                <br>
                <div class="items-center justify-center" style="text-align: center;"> <!-- Bouton de validation -->
                    <input class="cursor-pointer" style="width: 400px" type="submit" value="Ajouter dans la base de données">
                </div>
            </form>
            <img id="response" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        </div>
    </div>
</div>

<nav id="menu-nav" class="max-w-[350px] h-screen border-r border-black/10 fixed left-0 top-0 bg-white/80 backdrop-blur z-30" id="Menu">
    <ul id="Evenements" class="text-left">
        <li class="mb-10"> <!-- R2 logo -->
            <a href="/">
                <div class="logo-menu w-full bg-grey-500 flex items-center justify-center relative" style="height: 90px;">
                    <div class="absolute top-0 left-0 w-full h-2 gradient"></div> <!-- Thème de l'ui -->
                    <img style="display: flex;padding-top: 50px;" src="../Images/logo.svg" alt="logo Rennes2">
                </div>
            </a>
        </li>
        <li class="group border-y border-black/10" id="ButtonBox"> <!-- Bouton "je cherche une ressource" -->
            <a href="/ressource">
            <button class="relative px-4 py-8 hover:bg-black/10 hover:pl-6 transition-all block w-full">
                <div class="leading-4 mb-2 font-bold text-left">
                    Je cherche une ressource
                </div>
            </button>
        </a>
    </li>
    <li class="group border-b border-black/10" id="ButtonBox"> <!-- Bouton "je dépose une ressource" -->
        <a href="/depot">
            <button class="relative px-4 py-8 hover:bg-black/10 hover:pl-6 transition-all block w-full">
                <div class="absolute top-0 left-0 w-2 h-full gradient-v"></div> <!-- Barre de séléction -->  
                <div class="leading-4 mb-2 font-bold text-left">
                    Je dépose une ressource
                </div>
            </button>
        </a>
    </li>
    <li class="group border-b border-black/10" id="ButtonBox"> <!-- Bouton "Évènements" -->
        <a href="/events">
            <button class="relative px-4 py-8 hover:bg-black/10 hover:pl-6 transition-all block w-full">
                <div class="leading-4 mb-2 font-bold text-left">
                    Évènements
                </div>
            </button>
            </a>
        </li>
        <li class="group border-b border-black/10" id="ButtonBox"> <!-- Bouton "Charte des tiers-lieux" -->
            <a href="/charte">
            <button class="relative px-4 py-8 hover:bg-black/10 hover:pl-6 transition-all block w-full">
                <div class="leading-4 mb-2 font-bold text-left">
                    Charte des tiers-lieux
                </div>
            </button>
            </a>
        </li>
        <li class="absolute bottom-4 left-4" id="Charte"> <!-- Logo WorkAdventure -->
            <a href="https://workadventu.re/" target="_blank" class="transition-all block">
                <img src="../Images/WA.svg" alt="Logo Workadventu.re" />
            </a>
        </li>
    </ul>
</nav>
<script type="text/javascript"> // Drag n drop function
    const dropArea = document.getElementById("drop-area");
const previewImage = document.getElementById("preview");
const fileInput = document.getElementById("fileInput");

dropArea.addEventListener("dragover", (event) => {
    event.preventDefault();
    dropArea.classList.add("dragover");
});

dropArea.addEventListener("dragleave", () => {
    dropArea.classList.remove("dragover");
});

dropArea.addEventListener("drop", (event) => {
    event.preventDefault();
    dropArea.classList.remove("dragover");

    const file = event.dataTransfer.files[0];
    if (file && file.type.startsWith("image/")) {
        displayImage(file);
    } else {
        alert("Please drop an image file.");
    }
});

dropArea.addEventListener("click", () => {
    fileInput.click();
});

fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (file && file.type.startsWith("image/")) {
        displayImage(file);
    }
});

function displayImage(file) {
    const reader = new FileReader();
    reader.onload = (event) => {
        previewImage.src = event.target.result;
        previewImage.style.display = "block";
        dropArea.style.backgroundImage = "none";
    };
    reader.readAsDataURL(file);
}
</script>
<script type="text/javascript"> // Form informations sending
    document.getElementById('form').addEventListener('submit', async (event) => {
    event.preventDefault();
    const formData = new FormData();
    formData.append("resourceName", document.getElementById("resourceName").value);
    formData.append("link", document.getElementById("link").value);
    formData.append("areaName", document.getElementById("areaName").value);
    formData.append("room", document.getElementById("room").value);
    const fileInput = document.getElementById("fileInput");
    if (fileInput.files.length > 0) {
        formData.append("image", fileInput.files[0]);
    } else {
        alert("Please select an image.");
        return;
    }
    try {
        const response = await fetch('/insert', {
            method: 'POST',
            body: formData
        });
        if (response.ok) {
            const form = document.getElementById("form");
            const img = document.getElementById("response");
            console.log("after Getting all const");
            img.style.display = "block";
            img.src = "Images/ok.png";
            form.style.display = "none";
            alert("Resource added successfully!");
            console.log("Response:", await response.json());
        } else {
            alert("Couldn't insert resource!");
            const form = document.getElementById("form");
            const img = document.getElementById("response");
            img.style.display = "block";
            img.src = url("Images/ok.png")
            form.style.display = "none";
            console.error("Failed to upload:", response.statusText);
        }
    } catch (err) {
        console.error("Error inserting data: ", err);
    }
});
</script>
</body></html>